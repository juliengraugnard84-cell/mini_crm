{% extends "base.html" %}
{% block title %}Mises à jour demandées{% endblock %}

{% block content %}

<!-- ================= PAGE HEADER ================= -->
<div class="page-header mb-4">
    <h1>Mises à jour demandées</h1>
    <p class="text-muted">
        Demandes de modification envoyées par les commerciaux
    </p>
</div>

<!-- ================= LISTE DES DEMANDES ================= -->
<div class="card">

    {% if updates %}
    <table class="table">
        <thead>
            <tr>
                <th>Dossier</th>
                <th>Commercial</th>
                <th>Date demandée</th>
                <th></th>
            </tr>
        </thead>
        <tbody>

        {% for u in updates %}
            <tr class="{% if not u.is_read %}unread{% endif %}">
                <td>
                    <strong>{{ u.client_name }}</strong>
                </td>

                <td>
                    {{ u.commercial_name }}
                </td>

                <td>
                    {{ format_date(u.update_date) }}
                </td>

                <td style="text-align:right;">

                    <a href="{{ url_for('open_update', update_id=u.id) }}"
                       class="btn btn-secondary btn-sm">
                        Ouvrir
                    </a>

                    <!-- ===== AJOUT : SUPPRESSION UPDATE ADMIN ===== -->
                    <form method="post"
                          action="{{ url_for('delete_update', update_id=u.id) }}"
                          style="display:inline;"
                          onsubmit="return confirm('Supprimer définitivement cette demande de mise à jour ?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button class="btn btn-danger btn-sm">
                            Supprimer
                        </button>
                    </form>
                    <!-- ===== FIN AJOUT ===== -->

                </td>
            </tr>
        {% endfor %}

        </tbody>
    </table>
    {% else %}
        <p class="text-muted">
            Aucune demande de mise à jour en attente.
        </p>
    {% endif %}

</div>

{% endblock %}
