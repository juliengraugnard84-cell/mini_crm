{% extends "base.html" %}
{% block page_title %}Chiffre d'affaire{% endblock %}

{% block content %}

<h1 class="mb-4 fw-bold">Chiffre d'affaire</h1>

<!-- CARTES RÉSUMÉ -->
<div class="row g-4 mb-4">

    <div class="col-md-6">
        <div class="card card-modern card-animated fade-delay-1"
             style="background: linear-gradient(135deg, #ff6b35, #ff3366); color:white;">
            <div class="card-body">
                <h5 class="fw-bold">Total Mensuel (tous commerciaux)</h5>
                <div class="h3 fw-bold">{{ total_mensuel }} €</div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card card-modern card-animated fade-delay-2">
            <div class="card-body">
                <h5 class="fw-bold">Total Annuel (tous commerciaux)</h5>
                <div class="h3 fw-bold">{{ total_annuel }} €</div>
            </div>
        </div>
    </div>
</div>

<!-- TOTAlS PAR COMMERCIAL -->
<div class="card card-modern card-animated fade-delay-3 mb-4">
    <div class="card-header">
        <h5 class="fw-bold">Total mensuel par commercial</h5>
    </div>
    <div class="card-body">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Commercial</th>
                    <th>Total mensuel (€)</th>
                </tr>
            </thead>
            <tbody>
                {% for c in mensuel_par_com %}
                <tr>
                    <td>{{ c.commercial }}</td>
                    <td class="fw-bold">{{ c.total }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<div class="card card-modern card-animated fade-delay-4 mb-4">
    <div class="card-header">
        <h5 class="fw-bold">Total annuel par commercial</h5>
    </div>
    <div class="card-body">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Commercial</th>
                    <th>Total annuel (€)</th>
                </tr>
            </thead>
            <tbody>
                {% for c in annuel_par_com %}
                <tr>
                    <td>{{ c.commercial }}</td>
                    <td class="fw-bold">{{ c.total }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- FORMULAIRE AJOUT CA -->
<div class="card card-modern card-animated fade-delay-5">
    <div class="card-header">
        <h5 class="fw-bold">Ajouter un revenu</h5>
    </div>
    <div class="card-body">

        <form action="{{ url_for('chiffre_affaire') }}" method="POST" class="row g-3">

            <div class="col-md-4">
                <label class="form-label">Date</label>
                <input type="date" name="date" class="form-control" value="{{ today }}" required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Commercial</label>
                <input type="text" name="commercial" class="form-control" required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Montant (€)</label>
                <input type="number" name="montant" step="0.01" class="form-control" required>
            </div>

            <div class="col-12">
                <button class="btn btn-gradient">Valider</button>
            </div>
        </form>

    </div>
</div>

<!-- TABLE DES REVENUS -->
<div class="card card-modern card-animated fade-delay-6 mt-4">
    <div class="card-header">
        <h5 class="fw-bold">Historique des revenus</h5>
    </div>
    <div class="card-body">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Commercial</th>
                    <th>Montant (€)</th>
                    <th class="text-end">Supprimer</th>
                </tr>
            </thead>
            <tbody>
                {% for r in revenus %}
                <tr>
                    <td>{{ r.date }}</td>
                    <td>{{ r.commercial }}</td>
                    <td class="fw-bold">{{ r.montant }} €</td>

                    <td class="text-end">
                        <form action="{{ url_for('delete_revenue', rev_id=r.id) }}"
                              method="POST" style="display:inline;">
                            <button class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Supprimer ce revenu ?')">
                                <i class="material-icons">delete</i>
                            </button>
                        </form>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


{% endblock %}
