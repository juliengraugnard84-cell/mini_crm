{% extends "base.html" %}
{% block title %}Utilisateurs{% endblock %}

{% block content %}

<h1 class="page-title">Utilisateurs</h1>

<!-- AJOUT UTILISATEUR -->
<div class="card">

    <h5>Créer un utilisateur</h5>

    <form method="POST">

        <div class="row g-3">

            <div class="col-md-4">
                <label class="form-label">Nom d’utilisateur</label>
                <input type="text" name="username" class="form-control" required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Mot de passe</label>
                <input type="password" name="password" class="form-control" required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Rôle</label>
                <select name="role" class="form-select" required>
                    <option value="commercial">Commercial</option>
                    <option value="admin">Administrateur</option>
                </select>
            </div>

        </div>

        <div style="margin-top:16px;">
            <button class="btn btn-success">
                Créer l’utilisateur
            </button>
        </div>

    </form>

</div>

<!-- LISTE UTILISATEURS -->
<div class="card">

    <h5>Liste des utilisateurs</h5>

    {% if users %}
    <table class="table">
        <thead>
            <tr>
                <th>Utilisateur</th>
                <th>Rôle</th>
                <th style="text-align:right;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td><strong>{{ u.username }}</strong></td>
                <td>{{ u.role }}</td>
                <td style="text-align:right;">

                    <form method="POST"
                          action="{{ url_for('admin_reset_password', user_id=u.id) }}"
                          style="display:inline;">
                        <input type="password"
                               name="new_password"
                               placeholder="Nouveau mot de passe"
                               class="form-control"
                               style="display:inline-block;width:180px;">
                        <button class="btn btn-outline-secondary btn-sm">
                            Reset
                        </button>
                    </form>

                    {% if u.id != 1 %}
                    <form method="POST"
                          action="{{ url_for('admin_delete_user', user_id=u.id) }}"
                          style="display:inline;"
                          onsubmit="return confirm('Supprimer cet utilisateur ?');">
                        <button class="btn btn-danger btn-sm">
                            Supprimer
                        </button>
                    </form>
                    {% endif %}

                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted">Aucun utilisateur.</p>
    {% endif %}

</div>

{% endblock %}
