{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block page_title %}
<h1 class="page-title mb-4">Tableau de bord</h1>
{% endblock %}

{% block content %}

<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="kpi-tile kpi--blue">
            <div class="kpi-label">Clients</div>
            <div class="kpi-value">{{ total_clients }}</div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="kpi-tile kpi--green">
            <div class="kpi-label">Chiffre d’affaires</div>
            <div class="kpi-value">{{ total_ca | round(2) }} €</div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="kpi-tile kpi--orange">
            <div class="kpi-label">Documents</div>
            <div class="kpi-value">{{ total_docs }}</div>
        </div>
    </div>
</div>

<div class="row g-4">

    <div class="col-md-6">
        <div class="card p-3">
            <h5>Derniers clients</h5>
            <ul class="list-group list-group-flush">
                {% for c in last_clients %}
                <li class="list-group-item">
                    <strong>{{ c.name }}</strong><br>
                    <small class="text-muted">{{ c.email or "—" }}</small>
                </li>
                {% else %}
                <li class="list-group-item text-muted">Aucun client</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card p-3">
            <h5>Dernier revenu</h5>
            {% if last_rev %}
                <strong>{{ last_rev.montant }} €</strong><br>
                <small class="text-muted">
                    {{ last_rev.date }} — {{ last_rev.commercial }}
                </small>
            {% else %}
                <p class="text-muted">Aucun revenu enregistré</p>
            {% endif %}
        </div>
    </div>

</div>

{% if current_user and current_user.role == 'admin' %}
<div class="card p-3 mt-4">
    <h5>Cotations non lues ({{ unread_cotations }})</h5>
    <ul class="list-group">
        {% for c in cotations_admin %}
        <a href="{{ url_for('client_detail', client_id=c.client_id) }}"
           class="list-group-item list-group-item-action">
            <strong>{{ c.client_name }}</strong><br>
            <small class="text-muted">
                {{ c.energie_type or "—" }} — échéance {{ c.date_echeance or "—" }}
            </small>
        </a>
        {% else %}
        <li class="list-group-item text-muted">Aucune cotation</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% endblock %}
