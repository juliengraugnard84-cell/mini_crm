{% extends "base.html" %}
{% block page_title %}Dashboard{% endblock %}
{% block content %}

<div class="row g-4 mb-4">

    <div class="col-md-4">
        <div class="card card-modern card-animated fade-delay-1"
             style="background: linear-gradient(135deg, #ff6b35, #ff3366); color:white;">
            <div class="card-body">
                <h5 class="fw-bold mb-2">Total Clients</h5>
                <div style="font-size: 36px; font-weight:700;">
                    {{ total_clients }}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card card-modern card-animated fade-delay-2">
            <div class="card-body">
                <h5 class="fw-bold mb-2">Documents totaux</h5>
                <div style="font-size: 36px; font-weight:700;">
                    {{ total_docs }}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card card-modern card-animated fade-delay-3">
            <div class="card-body">
                <h5 class="fw-bold mb-2">Chiffre d'affaire total</h5>
                <div style="font-size: 36px; font-weight:700;">
                    {{ total_ca }} €
                </div>
            </div>
        </div>
    </div>

</div>


<!-- SECTION GRAPHIQUE -->
<div class="card card-modern card-animated fade-delay-2">
    <div class="card-header">
        <h5 class="fw-bold">Évolution du chiffre d'affaire</h5>
    </div>
    <div class="card-body">
        <canvas id="caChart" class="chart-animated"></canvas>
    </div>
</div>

<!-- LISTE DES DERNIERS CLIENTS -->
<div class="card card-modern card-animated fade-delay-3 mt-4">
    <div class="card-header">
        <h5 class="fw-bold">Derniers Clients</h5>
    </div>
    <div class="card-body">
        <table class="table table-hover fade-in fade-delay-2">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
            {% for c in last_clients %}
                <tr>
                    <td>{{ c.name }}</td>
                    <td>{{ c.email if c.email else "-" }}</td>
                    <td>{{ c.created_at }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    fetch("{{ url_for('chiffre_affaire_data') }}")
        .then(res => res.json())
        .then(data => {

            const ctx = document.getElementById("caChart");

            const chart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: "CA (€)",
                        data: data.data,
                        fill: true,
                        borderWidth: 3,
                        tension: 0.35,
                        borderColor: "#ff6b35",
                        backgroundColor: "rgba(255,107,53,0.25)"
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        });

});
</script>

{% endblock %}
