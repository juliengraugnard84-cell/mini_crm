{% extends "base.html" %}
{% block title %}Nouveau dossier client{% endblock %}

{% block content %}
<h1>Nouveau dossier client</h1>

<!-- ======================================================
     FORMULAIRE 1 — CRÉATION DU DOSSIER (INDÉPENDANT)
====================================================== -->
<form method="POST" enctype="multipart/form-data" action="{{ url_for('new_client') }}">

    <div class="card">
        <h5>Création du dossier</h5>

        <div class="form-group">
            <label class="form-label">Nom du dossier</label>
            <input
                type="text"
                name="name"
                class="form-control"
                placeholder="Entreprise Dupont – Site principal"
                required
            >
        </div>

        <div class="form-group">
            <label class="form-label">Documents à joindre</label>
            <input
                type="file"
                name="documents"
                class="form-control"
                multiple
            >
            <small class="text-muted">
                Vous pouvez créer le dossier sans demande de cotation.
            </small>
        </div>
    </div>

    <div class="actions-row">
        <button type="submit" class="btn btn-primary">
            Créer le dossier
        </button>
    </div>

</form>

<!-- ======================================================
     FORMULAIRE 2 — DEMANDE DE COTATION (OPTIONNELLE)
     Visible seulement APRÈS création du client
====================================================== -->

{% if client %}
<form method="POST"
      action="{{ url_for('create_cotation', client_id=client.id) }}"
      style="margin-top:32px;">

    <div class="card">
        <h5>Demande de cotation (optionnelle)</h5>

        <div class="form-group">
            <label class="form-label">Date de négociation</label>
            <input type="date" name="date_negociation" class="form-control">
        </div>

        <hr>

        <h5>Signataire</h5>

        <div class="form-group">
            <label class="form-label">Nom du signataire</label>
            <input type="text" name="signataire_nom" class="form-control">
        </div>

        <div class="form-group">
            <label class="form-label">Téléphone</label>
            <input type="tel" name="signataire_tel" class="form-control">
        </div>

        <div class="form-group">
            <label class="form-label">Adresse e-mail</label>
            <input type="email" name="signataire_email" class="form-control">
        </div>

        <hr>

        <h5>Entreprise</h5>

        <div class="form-group">
            <label class="form-label">SIRET</label>
            <input type="text" name="siret" class="form-control" maxlength="14">
        </div>

        <hr>

        <h5>Point de livraison</h5>

        <div class="form-group">
            <label class="form-label">PDL / PCE</label>
            <input type="text" name="pdl_pce" class="form-control">
        </div>

        <div class="form-group">
            <label class="form-label">Type d’énergie</label>
            <select name="energie_type" class="form-select">
                <option value="">— Sélectionner —</option>
                <option value="electricite">Électricité</option>
                <option value="gaz">Gaz</option>
            </select>
        </div>

        <hr>

        <h5>Fournisseur actuel</h5>

        <div class="form-group">
            <label class="form-label">Nom du fournisseur</label>
            <input type="text" name="fournisseur_actuel" class="form-control">
        </div>

        <div class="form-group">
            <label class="form-label">Date de fin de contrat</label>
            <input type="date" name="date_echeance" class="form-control">
        </div>
    </div>

    <div class="actions-row">
        <button type="submit" class="btn btn-secondary">
            Enregistrer la demande de cotation
        </button>
    </div>

</form>
{% endif %}

{% endblock %}
