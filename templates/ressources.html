{% extends "base.html" %}
{% block content %}

<div class="container-fluid">

  <!-- ================= HEADER ================= -->
  <div class="mb-4">
    <h2 class="mb-1">Ressources partagÃ©es</h2>
    <p class="text-muted mb-0">
      Mandats et lettres de rÃ©siliation accessibles aux administrateurs et commerciaux.
    </p>
  </div>

  <!-- ================= UPLOAD ================= -->
  {% if current_user and current_user.role in ["admin", "commercial"] %}
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">âž• Ajouter un document</h5>

      <form method="POST"
            action="{{ url_for('shared_resources_upload') }}"
            enctype="multipart/form-data"
            class="row g-3">

        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        <div class="col-md-4">
          <label class="form-label">Type de document</label>
          <select name="category" class="form-select" required>
            <option value="mandats">Mandat</option>
            <option value="resiliations">RÃ©siliation</option>
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">Fichier</label>
          <input type="file" name="file" class="form-control" required>
        </div>

        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">
            Uploader
          </button>
        </div>

      </form>
    </div>
  </div>
  {% endif %}

  <!-- ================= MANDATS ================= -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <strong>ðŸ“‚ Mandats</strong>
    </div>
    <div class="card-body p-0">

      <table class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Nom</th>
            <th style="width: 160px;">Date</th>
            <th style="width: 120px;">Taille</th>
            <th style="width: 160px;">Actions</th>
          </tr>
        </thead>
        <tbody>

        {% if mandats %}
          {% for f in mandats %}
          <tr>
            <td>{{ f.nom }}</td>
            <td>{{ format_date(f.date) }}</td>
            <td>{{ f.taille }}</td>
            <td>
              <a class="btn btn-sm btn-outline-primary"
                 href="{{ url_for('download_document', key=f.key) }}">
                TÃ©lÃ©charger
              </a>

              {% if current_user.role == "admin" %}
              <form method="POST"
                    action="{{ url_for('delete_document') }}"
                    class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="key" value="{{ f.key }}">
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('Supprimer ce mandat ?')">
                  Supprimer
                </button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" class="text-center text-muted py-4">
              Aucun mandat disponible
            </td>
          </tr>
        {% endif %}

        </tbody>
      </table>

    </div>
  </div>

  <!-- ================= RÃ‰SILIATIONS ================= -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <strong>ðŸ“‚ RÃ©siliations</strong>
    </div>
    <div class="card-body p-0">

      <table class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Nom</th>
            <th style="width: 160px;">Date</th>
            <th style="width: 120px;">Taille</th>
            <th style="width: 160px;">Actions</th>
          </tr>
        </thead>
        <tbody>

        {% if resiliations %}
          {% for f in resiliations %}
          <tr>
            <td>{{ f.nom }}</td>
            <td>{{ format_date(f.date) }}</td>
            <td>{{ f.taille }}</td>
            <td>
              <a class="btn btn-sm btn-outline-primary"
                 href="{{ url_for('download_document', key=f.key) }}">
                TÃ©lÃ©charger
              </a>

              {% if current_user.role == "admin" %}
              <form method="POST"
                    action="{{ url_for('delete_document') }}"
                    class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="key" value="{{ f.key }}">
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('Supprimer cette rÃ©siliation ?')">
                  Supprimer
                </button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" class="text-center text-muted py-4">
              Aucune rÃ©siliation disponible
            </td>
          </tr>
        {% endif %}

        </tbody>
      </table>

    </div>
  </div>

</div>

{% endblock %}
