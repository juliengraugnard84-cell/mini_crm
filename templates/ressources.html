{% extends "base.html" %}
{% block content %}

<h2>Ressources (Admin + Commerciaux)</h2>

{# =======================================================
   UPLOAD â€” ADMIN + COMMERCIAUX
   ======================================================= #}
{% if current_user and current_user.role in ["admin", "commercial"] %}
<form
  method="POST"
  action="{{ url_for('shared_resources_upload') }}"
  enctype="multipart/form-data"
  style="margin-bottom: 1.5rem;"
>
  <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

  <label for="category"><strong>Type de document</strong></label><br>
  <select name="category" id="category" required>
    <option value="mandats">Mandats</option>
    <option value="resiliations">RÃ©siliations</option>
  </select>

  <br><br>

  <input type="file" name="file" required>
  <button type="submit">Uploader le document</button>
</form>
<hr>
{% endif %}

{# =======================================================
   ðŸ“‚ MANDATS
   ======================================================= #}
<h3>ðŸ“‚ Mandats</h3>

<table>
  <thead>
    <tr>
      <th>Nom</th>
      <th>Date</th>
      <th>Taille</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>

  {% if mandats %}
    {% for f in mandats %}
      <tr>
        <td>{{ f.nom }}</td>
        <td>{{ format_date(f.date) }}</td>
        <td>{{ f.taille }}</td>
        <td>
          <a href="{{ url_for('download_document', key=f.key) }}">TÃ©lÃ©charger</a>

          {% if current_user and current_user.role == "admin" %}
            <form method="POST"
                  action="{{ url_for('delete_document') }}"
                  style="display:inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <input type="hidden" name="key" value="{{ f.key }}">
              <button type="submit"
                      onclick="return confirm('Supprimer ce mandat ?')">
                Supprimer
              </button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  {% else %}
    <tr>
      <td colspan="4" style="text-align:center;">
        Aucun mandat disponible.
      </td>
    </tr>
  {% endif %}

  </tbody>
</table>

<br>

{# =======================================================
   ðŸ“‚ RÃ‰SILIATIONS
   ======================================================= #}
<h3>ðŸ“‚ RÃ©siliations</h3>

<table>
  <thead>
    <tr>
      <th>Nom</th>
      <th>Date</th>
      <th>Taille</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>

  {% if resiliations %}
    {% for f in resiliations %}
      <tr>
        <td>{{ f.nom }}</td>
        <td>{{ format_date(f.date) }}</td>
        <td>{{ f.taille }}</td>
        <td>
          <a href="{{ url_for('download_document', key=f.key) }}">TÃ©lÃ©charger</a>

          {% if current_user and current_user.role == "admin" %}
            <form method="POST"
                  action="{{ url_for('delete_document') }}"
                  style="display:inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <input type="hidden" name="key" value="{{ f.key }}">
              <button type="submit"
                      onclick="return confirm('Supprimer cette rÃ©siliation ?')">
                Supprimer
              </button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  {% else %}
    <tr>
      <td colspan="4" style="text-align:center;">
        Aucune rÃ©siliation disponible.
      </td>
    </tr>
  {% endif %}

  </tbody>
</table>

{% endblock %}
