<!-- Chat Floating Button -->
<button id="chat-toggle" class="chat-toggle" type="button" aria-label="Ouvrir le chat">
  <span class="chat-toggle-icon">ðŸ’¬</span>
  <span id="chat-badge" class="chat-badge" style="display:none;">0</span>
</button>

<!-- Chat Widget -->
<div id="chat-widget" class="chat-widget" aria-hidden="true">
  <div class="chat-header">
    <div class="chat-header-left">
      <div class="chat-title">Chat</div>
      <div class="chat-subtitle">Support interne</div>
    </div>
    <button id="chat-close" class="chat-close" type="button" aria-label="Fermer">âœ•</button>
  </div>

  <div id="chat-messages"
       class="chat-messages"
       role="log"
       aria-live="polite"></div>

  <form id="chat-form"
        class="chat-inputbar"
        enctype="multipart/form-data">

    <label class="chat-attach" title="Joindre un fichier">
      ðŸ“Ž
      <input id="chat-file" name="file" type="file">
    </label>

    <textarea
      id="chat-input"
      name="message"
      class="chat-input"
      rows="1"
      placeholder="Ã‰crire un messageâ€¦"></textarea>

    <button class="chat-send"
            type="submit"
            aria-label="Envoyer">âž¤</button>
  </form>
</div>

<script>
  /*
    IMPORTANT
    ----------
    - Utilisation systÃ©matique de |tojson
    - Aucun "null" en string
    - JavaScript toujours valide
  */

  window.CHAT_CURRENT_USER_ID = {{ (current_user.id if current_user else None) | tojson }};
  window.CHAT_CURRENT_USERNAME = {{ (current_user.username if current_user else None) | tojson }};
  window.CHAT_CSRF_TOKEN = {{ (csrf_token if csrf_token else None) | tojson }};
</script>
