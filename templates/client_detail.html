{% extends "base.html" %}
{% block title %}Client{% endblock %}

{% block content %}

<h1 class="page-title mb-4">{{ client.name }}</h1>

<div class="row g-4">

    <!-- ========================= -->
    <!-- INFOS CLIENT -->
    <!-- ========================= -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <p><strong>Email :</strong> {{ client.email or "—" }}</p>
                <p><strong>Téléphone :</strong> {{ client.phone or "—" }}</p>
                <p><strong>Commercial :</strong> {{ client.commercial }}</p>
                <p><strong>Notes :</strong><br>{{ client.notes or "—" }}</p>

                <a href="{{ url_for('edit_client', client_id=client.id) }}"
                   class="btn btn-sm btn-outline-secondary mt-2">
                    Modifier le client
                </a>
            </div>
        </div>
    </div>

    <!-- ========================= -->
    <!-- DEMANDE DE COTATION + LISTE -->
    <!-- ========================= -->
    <div class="col-md-8">

        <!-- FORMULAIRE DEMANDE DE COTATION -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <strong>Demande de cotation</strong>
            </div>

            <div class="card-body">
                <form method="POST"
                      action="{{ url_for('create_cotation', client_id=client.id) }}">

                    <div class="row g-3">

                        <div class="col-md-4">
                            <label class="form-label">Date de négociation</label>
                            <input type="date" name="date_negociation" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Type d’énergie</label>
                            <select name="energie_type" class="form-select">
                                <option value="">—</option>
                                <option value="gaz">Gaz</option>
                                <option value="electricite">Électricité</option>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Nom de l’entreprise</label>
                            <input name="entreprise_nom" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">SIRET</label>
                            <input name="siret" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Nom du signataire</label>
                            <input name="signataire_nom" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Téléphone</label>
                            <input name="signataire_tel" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Email</label>
                            <input type="email" name="signataire_email" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">PDL / PCE</label>
                            <input name="pdl_pce" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Fournisseur actuel</label>
                            <input name="fournisseur_actuel" class="form-control">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Date d’échéance</label>
                            <input type="date" name="date_echeance" class="form-control">
                        </div>

                        <div class="col-12">
                            <label class="form-label">Commentaire</label>
                            <textarea name="commentaire"
                                      class="form-control"
                                      rows="3"></textarea>
                        </div>

                    </div>

                    <div class="text-end mt-4">
                        <button class="btn btn-success px-4">
                            Enregistrer la demande
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- LISTE DES DEMANDES DE COTATION -->
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <strong>Demandes de cotation</strong>
            </div>

            <div class="card-body">

                {% for c in cotations %}
                <div class="border rounded p-3 mb-3 cotation-card">

                    <div class="d-flex justify-content-between align-items-center">
                        <strong>{{ c.entreprise_nom or client.name }}</strong>
                        {% if c.energie_type %}
                        <span class="badge bg-secondary">
                            {{ c.energie_type | capitalize }}
                        </span>
                        {% endif %}
                    </div>

                    <div class="text-muted small mb-2">
                        Échéance : {{ c.date_echeance or "—" }}
                    </div>

                    <ul class="small mb-2">
                        <li>Signataire : {{ c.signataire_nom or "—" }}</li>
                        <li>Email : {{ c.signataire_email or "—" }}</li>
                        <li>Téléphone : {{ c.signataire_tel or "—" }}</li>
                        <li>SIRET : {{ c.siret or "—" }}</li>
                        <li>PDL / PCE : {{ c.pdl_pce or "—" }}</li>
                        <li>Fournisseur : {{ c.fournisseur_actuel or "—" }}</li>
                    </ul>

                    {% if c.commentaire %}
                    <div class="fst-italic small text-muted">
                        “{{ c.commentaire }}”
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <p class="text-muted">Aucune demande de cotation.</p>
                {% endfor %}

            </div>
        </div>

    </div>
</div>

{% endblock %}
