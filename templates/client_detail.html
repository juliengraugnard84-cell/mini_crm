{% extends "base.html" %}
{% block title %}Client – {{ client.name }}{% endblock %}

{% block content %}

<h1 class="page-title">
    {{ client.name }}
</h1>

<!-- ================= INFOS CLIENT ================= -->
<div class="card mb-4">

    <h5>Informations client</h5>

    <div class="row g-3">

        <div class="col-md-6">
            <strong>Email :</strong><br>
            {{ client.email or "—" }}
        </div>

        <div class="col-md-6">
            <strong>Téléphone :</strong><br>
            {{ client.phone or "—" }}
        </div>

        <div class="col-md-6">
            <strong>Commercial :</strong><br>
            {{ client.commercial or "—" }}
        </div>

        <div class="col-md-6">
            <strong>Statut :</strong><br>
            {{ client.status or "—" }}
        </div>

        <div class="col-md-12">
            <strong>Adresse :</strong><br>
            {{ client.address or "—" }}
        </div>

        {% if client.notes %}
        <div class="col-md-12">
            <strong>Notes :</strong><br>
            <div class="text-muted">{{ client.notes }}</div>
        </div>
        {% endif %}

    </div>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px;">
        <a href="{{ url_for('edit_client', client_id=client.id) }}"
           class="btn btn-primary">
            Modifier
        </a>

        <form method="POST"
              action="{{ url_for('delete_client', client_id=client.id) }}"
              onsubmit="return confirm('Supprimer définitivement ce client ?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button class="btn btn-danger">
                Supprimer
            </button>
        </form>
    </div>

</div>

<!-- ================= DEMANDE DE COTATION ================= -->
<div class="card mb-4">

    <h5>Nouvelle demande de cotation</h5>

    <form method="POST"
          action="{{ url_for('create_cotation', client_id=client.id) }}">

        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        <div class="row g-3">

            <div class="col-md-4">
                <label class="form-label">Date de négociation</label>
                <input type="date" name="date_negociation" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Type d’énergie</label>
                <select name="energie_type" class="form-select">
                    <option value="">—</option>
                    <option value="électricité">Électricité</option>
                    <option value="gaz">Gaz</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label">Date d’échéance</label>
                <input type="date" name="date_echeance" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">Entreprise</label>
                <input type="text" name="entreprise_nom" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">SIRET</label>
                <input type="text" name="siret" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Signataire</label>
                <input type="text" name="signataire_nom" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Téléphone signataire</label>
                <input type="text" name="signataire_tel" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Email signataire</label>
                <input type="email" name="signataire_email" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">PDL / PCE</label>
                <input type="text" name="pdl_pce" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">Fournisseur actuel</label>
                <input type="text" name="fournisseur_actuel" class="form-control">
            </div>

            <div class="col-md-12">
                <label class="form-label">Commentaire</label>
                <textarea name="commentaire" class="form-control" rows="3"></textarea>
            </div>

        </div>

        <div style="margin-top:16px;">
            <button class="btn btn-success">
                Enregistrer la demande
            </button>
        </div>

    </form>

</div>

<!-- ================= HISTORIQUE DES COTATIONS ================= -->
<div class="card mb-4">

    <h5>Historique des cotations</h5>

    {% if cotations %}
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Énergie</th>
                <th>Entreprise</th>
                <th>Échéance</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% for c in cotations %}
            <tr>
                <td>{{ c.date_negociation or "—" }}</td>
                <td>{{ c.energie_type or "—" }}</td>
                <td>{{ c.entreprise_nom or "—" }}</td>
                <td>{{ c.date_echeance or "—" }}</td>
                <td>{{ c.status or "nouvelle" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted">Aucune cotation enregistrée.</p>
    {% endif %}

</div>

<!-- ================= DOCUMENTS CLIENT ================= -->
<div class="card">

    <h5>Documents</h5>

    {% if documents %}
    <ul class="list-group">
        {% for d in documents %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>{{ d.nom }}</span>
            {% if d.url %}
            <a href="{{ d.url }}" target="_blank" class="btn btn-outline-secondary btn-sm">
                Ouvrir
            </a>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% else %}
        <p class="text-muted">Aucun document associé.</p>
    {% endif %}

</div>

{% endblock %}
