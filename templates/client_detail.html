{% extends "base.html" %}
{% block title %}Client — {{ client.name }}{% endblock %}

{% block content %}

<!-- ================= HEADER ================= -->
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <h1>{{ client.name }}</h1>

    <!-- Actions désactivées tant que les routes n'existent pas -->
    <div class="actions-row">
        <button class="btn btn-secondary" disabled>
            ✏ Modifier
        </button>
    </div>
</div>

<!-- ================= INFOS CLIENT ================= -->
<div class="card">
    <h5>Informations client</h5>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;">

        <div>
            <div class="form-label">Commercial</div>
            {{ client.commercial or "—" }}
        </div>

        <div>
            <div class="form-label">Date de création</div>
            {{ client.created_at[:10] if client.created_at else "—" }}
        </div>

        <div>
            <div class="form-label">Statut</div>

            {% set s = (client.status or '').lower() %}
            {% if s == 'signé' %}
                <span class="badge badge-success">Signé</span>
            {% elif s == 'en cours' %}
                <span class="badge badge-warning">En cours</span>
            {% elif s == 'perdu' %}
                <span class="badge badge-danger">Perdu</span>
            {% else %}
                <span class="badge badge-info">Cotation</span>
            {% endif %}
        </div>

    </div>
</div>

<!-- ================= COTATIONS ================= -->
<div class="card">
    <h5>Demandes de cotation</h5>

    {% if cotations %}
        {% for cot in cotations %}
        <div class="list-group-item"
             style="display:flex;justify-content:space-between;align-items:center;gap:16px;">

            <div>
                <strong>{{ cot.energie_type or "—" }}</strong><br>
                <small class="text-muted">
                    Créée le {{ cot.date_creation[:10] }}
                </small>
            </div>

            <span class="badge badge-info">
                {{ cot.status or "Nouvelle" }}
            </span>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <strong>Aucune cotation</strong>
            Aucune demande de cotation pour ce dossier.
        </div>
    {% endif %}
</div>

<!-- ================= DOCUMENTS ================= -->
<div class="card">
    <h5>Documents</h5>

    {% if documents %}
        {% for d in documents %}
        <div class="list-group-item"
             style="display:flex;justify-content:space-between;align-items:center;gap:16px;">
            <span>{{ d.nom }}</span>
            <a href="{{ d.url }}" target="_blank" class="btn btn-secondary">
                Ouvrir
            </a>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <strong>Aucun document</strong>
            Aucun document associé à ce dossier.
        </div>
    {% endif %}
</div>

{% endblock %}
