{% extends "base.html" %}
{% block title %}Client — {{ client.name }}{% endblock %}

{% block content %}

<h1>{{ client.name }}</h1>

<!-- =========================
     INFORMATIONS CLIENT
========================= -->
<div class="card">
    <h4>Informations client</h4>

    <div class="grid-3">
        <div>
            <strong>Commercial</strong><br>
            {{ client.commercial or "—" }}
        </div>

        <div>
            <strong>Date de création</strong><br>
            {{ client.created_at[:10] if client.created_at else "—" }}
        </div>

        <div>
            <strong>Statut</strong><br>
            {{ client.status or "Cotation" }}
        </div>
    </div>
</div>

<!-- =========================
     NOUVELLE DEMANDE DE COTATION
========================= -->
<div class="card" style="margin-top:24px;">
    <h4>Nouvelle demande de cotation</h4>

    <form method="POST"
          action="{{ url_for('create_cotation', client_id=client.id) }}">

        <div class="grid-2">

            <div class="form-group">
                <label>Date de négociation</label>
                <input type="date" name="date_negociation" class="form-control">
            </div>

            <div class="form-group">
                <label>Type d’énergie</label>
                <select name="energie_type" class="form-select">
                    <option value="">— Sélectionner —</option>
                    <option value="electricite">Électricité</option>
                    <option value="gaz">Gaz</option>
                </select>
            </div>

            <div class="form-group">
                <label>Nom du signataire</label>
                <input type="text" name="signataire_nom" class="form-control">
            </div>

            <div class="form-group">
                <label>Téléphone</label>
                <input type="tel" name="signataire_tel" class="form-control">
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" name="signataire_email" class="form-control">
            </div>

            <div class="form-group">
                <label>SIRET</label>
                <input type="text" name="siret" maxlength="14" class="form-control">
            </div>

            <div class="form-group">
                <label>PDL / PCE</label>
                <input type="text" name="pdl_pce" class="form-control">
            </div>

            <div class="form-group">
                <label>Date d’échéance du contrat</label>
                <input type="date" name="date_echeance" class="form-control">
            </div>

            <div class="form-group">
                <label>Fournisseur actuel</label>
                <input type="text" name="fournisseur_actuel" class="form-control">
            </div>

        </div>

        <div class="form-group">
            <label>Commentaires (cotation)</label>
            <textarea name="commentaire"
                      rows="4"
                      class="form-control"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">
            Envoyer la demande de cotation
        </button>
    </form>
</div>

<!-- =========================
     MISE À JOUR DU DOSSIER
========================= -->
<div class="card" style="margin-top:24px;">
    <h4>Mise à jour du dossier</h4>

    <form method="POST" action="#">

        <div class="grid-2">
            <div class="form-group">
                <label>Date de mise à jour</label>
                <input type="date" name="update_date" class="form-control">
            </div>
        </div>

        <div class="form-group">
            <label>Commentaires de mise à jour</label>
            <textarea name="update_comment"
                      rows="4"
                      class="form-control"
                      placeholder="Ex : Client rappelé, documents manquants, attente fournisseur…"></textarea>
        </div>

        <button type="submit" class="btn btn-secondary">
            Enregistrer la mise à jour
        </button>

    </form>
</div>

<!-- =========================
     LISTE DES COTATIONS
========================= -->
<div class="card" style="margin-top:24px;">
    <h4>Demandes de cotation</h4>

    {% if cotations %}
        {% for c in cotations %}
            <div class="list-item">
                <strong>{{ c.energie_type or "—" }}</strong>
                — {{ c.date_creation[:10] }}
            </div>
        {% endfor %}
    {% else %}
        <p class="muted">Aucune demande de cotation.</p>
    {% endif %}
</div>

<!-- =========================
     DOCUMENTS
========================= -->
<div class="card" style="margin-top:24px;">
    <h4>Documents</h4>

    {% if documents %}
        {% for d in documents %}
            <div class="doc-row">
                {{ d.nom }}
                <a href="{{ d.url }}" target="_blank" class="btn btn-secondary">
                    Ouvrir
                </a>
            </div>
        {% endfor %}
    {% else %}
        <p class="muted">Aucun document.</p>
    {% endif %}
</div>

{% endblock %}
