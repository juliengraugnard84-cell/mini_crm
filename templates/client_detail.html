{% extends "base.html" %}

{% block content %}

<div class="page-header">
    <h1>{{ client.name }}</h1>
</div>

<!-- ================= INFOS CLIENT ================= -->
<div class="card">
    <h3>Informations client</h3>

    <div class="info-grid">
        <div class="info-item">
            <span>Commercial</span>
            <strong>{{ client.commercial_name or "—" }}</strong>
        </div>

        <div class="info-item">
            <span>Date de création</span>
            <strong>{{ client.created_at[:10] if client.created_at else "—" }}</strong>
        </div>

        <div class="info-item">
            <span>Statut</span>
            <strong>{{ client.status or "—" }}</strong>
        </div>
    </div>
</div>

<!-- ================= DOCUMENTS (LECTURE SEULE) ================= -->
<div class="card">
    <h3>Documents</h3>

    <ul class="doc-list">
        {% for doc in documents %}
            <li>
                <a href="{{ doc.url }}" target="_blank">
                    {{ doc.nom }}
                </a>
            </li>
        {% else %}
            <li>Aucun document</li>
        {% endfor %}
    </ul>
</div>

<!-- ================= NOUVELLE COTATION ================= -->
<div class="card">
    <h3>Nouvelle demande de cotation</h3>

    <form method="post"
          action="{{ url_for('create_cotation', client_id=client.id) }}">

        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        <div class="form-grid">
            <div>
                <label>Date de négociation</label>
                <input type="date" name="date_negociation">
            </div>

            <div>
                <label>Type d’énergie</label>
                <select name="energie_type">
                    <option value="">— Sélectionner —</option>
                    <option value="electricite">Électricité</option>
                    <option value="gaz">Gaz</option>
                </select>
            </div>

            <div>
                <label>PDL / PCE</label>
                <input type="text" name="pdl_pce">
            </div>

            <div>
                <label>Date d’échéance</label>
                <input type="date" name="date_echeance">
            </div>

            <div>
                <label>Fournisseur actuel</label>
                <input type="text" name="fournisseur_actuel">
            </div>

            <div>
                <label>Entreprise</label>
                <input type="text" name="entreprise_nom">
            </div>

            <div>
                <label>SIRET</label>
                <input type="text" name="siret">
            </div>

            <div>
                <label>Signataire</label>
                <input type="text" name="signataire_nom">
            </div>

            <div>
                <label>Téléphone</label>
                <input type="text" name="signataire_tel">
            </div>

            <div>
                <label>Email</label>
                <input type="email" name="signataire_email">
            </div>
        </div>

        <label>Commentaire</label>
        <textarea name="commentaire" rows="4"></textarea>

        <button class="btn btn-primary" type="submit">
            Créer la demande
        </button>
    </form>
</div>

<!-- ================= HISTORIQUE ================= -->
<div class="card">
    <h3>Historique des cotations</h3>

    {% if cotations %}
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Énergie</th>
                    <th>Fournisseur</th>
                    <th>Statut</th>
                </tr>
            </thead>
            <tbody>
                {% for c in cotations %}
                <tr>
                    <td>{{ c.date_creation[:10] if c.date_creation else "—" }}</td>
                    <td>{{ c.energie_type or "—" }}</td>
                    <td>{{ c.fournisseur_actuel or "—" }}</td>
                    <td>{{ c.status or "—" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Aucune cotation enregistrée.</p>
    {% endif %}
</div>

{% endblock %}
